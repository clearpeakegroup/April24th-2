RUN --mount=type=cache,target=/root/.cache/pip \
    # syntax=docker/dockerfile:1.4
RUN --mount=type=cache,target=/root/.cache/pip \
    FROM nvidia/cuda:11.8.0-runtime-ubuntu22.04
RUN --mount=type=cache,target=/root/.cache/pip \
    
RUN --mount=type=cache,target=/root/.cache/pip \
    # keep Python stdout un-buffered
RUN --mount=type=cache,target=/root/.cache/pip \
    ENV PYTHONUNBUFFERED=1
RUN --mount=type=cache,target=/root/.cache/pip \
    
RUN --mount=type=cache,target=/root/.cache/pip \
    # system deps (python 3.10 + build tooling)
RUN --mount=type=cache,target=/root/.cache/pip \
    RUN apt-get update && \
RUN --mount=type=cache,target=/root/.cache/pip \
        apt-get install -y --no-install-recommends \
RUN --mount=type=cache,target=/root/.cache/pip \
            python3.10 python3.10-venv python3-pip python3.10-dev \
RUN --mount=type=cache,target=/root/.cache/pip \
            build-essential swig git libffi-dev libzmq3-dev && \
RUN --mount=type=cache,target=/root/.cache/pip \
        rm -rf /var/lib/apt/lists/*
RUN --mount=type=cache,target=/root/.cache/pip \
    CMD ["uvicorn", "backend.api:app", "--host", "0.0.0.0", "--port", "8000"]
RUN --mount=type=cache,target=/root/.cache/pip \
    # --- FinRL 0.3.5 (no deps) + latest ccxt ---
RUN --mount=type=cache,target=/root/.cache/pip \
    RUN --mount=type=cache,target=/root/.cache/pip python3 -m pip install --no-cache-dir --no-deps \
RUN --mount=type=cache,target=/root/.cache/pip \
        git+https://github.com/AI4Finance-Foundation/FinRL@v0.3.5#egg=FinRL
RUN --mount=type=cache,target=/root/.cache/pip \
    RUN --mount=type=cache,target=/root/.cache/pip python3 -m pip install --no-cache-dir ccxt
RUN --mount=type=cache,target=/root/.cache/pip \
    # --- Torch CUDA 11.8 ---
RUN --mount=type=cache,target=/root/.cache/pip \
    RUN --mount=type=cache,target=/root/.cache/pip \
RUN --mount=type=cache,target=/root/.cache/pip \
        python3 -m pip install --no-cache-dir \
RUN --mount=type=cache,target=/root/.cache/pip \
        torch==2.0.1+cu118 \
RUN --mount=type=cache,target=/root/.cache/pip \
        --index-url https://download.pytorch.org/whl/cu118
RUN --mount=type=cache,target=/root/.cache/pip \
    # --- Latest ccxt ---
RUN --mount=type=cache,target=/root/.cache/pip \
        python3 -m pip install --no-cache-dir ccxt
